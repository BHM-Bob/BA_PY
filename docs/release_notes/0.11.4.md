# Release Notes ‚Äì `mbapy` Library  
**Version:** 0.11.4  
**Release Date:** 2025-08-06  
**Maintainer:** BHM-Bob_G  

---

## Overview
This release consolidates **63 commits** spanning from 2025-04-06 to 2025-08-06.  
The focus is on **robust file handling**, **CLI usability**, **task execution reliability**, and **statistical tooling refinements**.  
All changes are backward-compatible unless explicitly noted.

---

## üöÄ New Features

### Scripts & CLI
- **`copy_file.py`**  
  Added `--on-exist` option to control behaviour when the target file already exists:  
  - `skip` ‚Äì do nothing  
  - `overwrite` ‚Äì replace existing file  
  - `rename` ‚Äì append a UUID suffix to create a unique filename  
- **`remove_file.py`**  
  `-t/--type` now accepts **multiple file extensions** (`nargs='+'`) instead of a single comma-separated string.  
- **`batch_cmd.py`** *(new)*  
  Utility script to execute batch system commands with logging and error handling.

### Library API
- **`mbapy.file.get_valid_path_on_exists()`**  
  Generates a unique file path by appending a short UUID if the original path exists.

---

## ‚öôÔ∏è Improvements

### Core Functionality
- **`TaskPool`**  
  - Added `RUNNING` and `QUEUED` statuses to `TaskStatus` enum for better observability.  
  - Introduced optional `report_error` parameter to surface task failures immediately.  
  - Fixed race condition in `_run_process_loop` when checking `pool_is_free`.  

- **`DataSetRAM.split()`**  
  Now supports integer indices for slicing, enabling more flexible dataset partitioning.  

- **`BaseInfo.to_json()`**  
  Added automatic traceback printing on serialization failure to aid debugging.

### Scientific & Statistical Tools
- **`multicomp_dunnett()`**  
  - Parameter renamed from `exp` ‚Üí `tag` for clarity.  
  - Updated control parameter handling to align with upstream `statsmodels`.  

- **`stats` module** *(Chinese refactor)*  
  Optimized confidence interval calculation logic:  
  - Auto-selects **t-distribution** or **normal distribution** based on sample size and user-provided sigma.  
  - Improves accuracy for small samples.

---

## üêõ Bug Fixes

### Scripts
- **`avif.py`**  
  - Fixed import path for `register_avif_opener`.  
  - File size calculation now uses return value instead of side-effect.  
  - Added timeout for `pool.close()` to prevent hanging on exit.  

- **`copy_file.py`**  
  Enhanced error handling for edge cases (e.g., read-only destinations, broken symlinks).

### Library
- **`mass/_utils.py::_plot_tag_by_match_df`**  
  Prevents index out-of-range error when `len(data.match_df) + 1` exceeds `PLT_MARKERS`.  

- **`resume_checkpoint()`**  
  Added `strict=False` option when loading optimizer state to tolerate missing keys.  

- **`web_utils.request`**   
  Improved random sleep logic to reduce server load and avoid 429 responses.

---

## üì¶ Dependency & Build
None or minor updates.


---

## üìö Documentation & Chores
- **`README.md`**  
  - Updated `LastEditTime`.  
  - Added DeepWiKi badge.  

- **Test files & examples**  
  Refactored to reflect new argument styles (`nargs='+'`) and added missing edge-case tests.

---

## üîß Known Limitations
- **`copy_file.py`**  
  The `--on-exist rename` option generates UUIDs deterministically based on current time; extremely rapid successive copies (sub-millisecond) could theoretically collide.  
- **`batch_cmd.py`**  
  No built-in shell-escaping for command arguments; callers must sanitize inputs.

---

## üìÑ Migration Guide
No breaking changes. Users relying on the **old comma-separated** `--type` syntax in `remove_file.py` need to switch to space-separated values:

```bash
# Before (deprecated)
remove_file -t jpg,png

# After
remove_file -t jpg png
```


---

**Full Changelog:** [GitHub Compare View](https://github.com/BHM-Bob/BA_PY/compare/2025.05.31...2025.08.06)  
**Documentation:** [Wiki](https://github.com/BHM-Bob/BA_PY/wiki)  
**Issues & Feedback:** [GitHub Issues](https://github.com/BHM-Bob/BA_PY/issues)